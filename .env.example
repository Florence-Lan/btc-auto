# Binance API Key：用于账户鉴权与交易请求签名（实盘敏感信息，勿外泄）。
BINANCE_API_KEY=your_api_key
# Binance API Secret：与 API Key 配套使用（实盘敏感信息，勿外泄）。
BINANCE_API_SECRET=your_api_secret

# BTCUSDT 永续合约（ccxt 符号格式）
# 交易标的，可选示例：BTC/USDT:USDT、ETH/USDT:USDT、SOL/USDT:USDT（需为 Binance U 本位永续，格式为 BASE/USDT:USDT）。
SYMBOL=BTC/USDT:USDT

# 交易参数
# 杠杆倍数，可选范围：1~125（受交易对与账户限制）；当前为 20。
LEVERAGE=20
# 保证金模式，可选：isolated（逐仓）/ cross（全仓）；当前为 isolated。
MARGIN_MODE=isolated
# 持仓模式，可选：false（单向持仓，多空互斥）/ true（双向持仓，多空可同时持有）；当前为 false。
HEDGE_MODE=false
# K 线周期，可选示例：1m、3m、5m、15m、30m、1h、4h、1d；当前为 5m。
TIMEFRAME=5m
# 每轮拉取 K 线数量：用于趋势指标计算。
KLINES_LIMIT=200
# 轮询间隔（秒）：每 20 秒检查一次，且只在新收盘 K 线上决策。
POLL_SECONDS=20

# 趋势信号（EMA + MA）
# EMA 快线周期：当前为 7（短周期方向）。
FAST_EMA=7
# EMA 慢线周期：当前为 25（短中周期方向）。
SLOW_EMA=25
# MA 快线周期：当前为 7（短周期方向）。
FAST_MA=7
# MA 慢线周期：当前为 25（短中周期方向）。
SLOW_MA=25
# MA 长周期：当前为 99（长期趋势过滤）。
MA_PERIOD=99
# 趋势阈值基准（兼容参数）。
TREND_SPREAD_THRESHOLD=0.0009
# 多头趋势阈值：多单更严，要求更大的 EMA/MA 价差。
LONG_TREND_SPREAD_THRESHOLD=0.00115
# 空头趋势阈值：空单更松，允许更小的 EMA/MA 价差。
SHORT_TREND_SPREAD_THRESHOLD=0.00063
# 高周期收盘确认：默认用 15m 收盘方向做二次过滤（可选示例：15m、30m、1h）。
CONFIRM_TIMEFRAME=15m
# 高周期K线拉取条数：用于计算高周期趋势确认。
CONFIRM_KLINES_LIMIT=300
# 回踩容忍度基准（兼容参数）。
RETEST_TOLERANCE=0.00160
# 多头回踩容忍度：多单更严（更小）。
LONG_RETEST_TOLERANCE=0.00152
# 空头回踩容忍度：空单更松（更大）。
SHORT_RETEST_TOLERANCE=0.00309
# 行情状态切换：趋势强度阈值（|EMA7-EMA25|/price）。
REGIME_TREND_STRENGTH=0.00176
# 行情状态切换：震荡强度阈值（小于该值倾向判定为震荡）。
REGIME_RANGE_STRENGTH=0.00073
# 行情状态切换：布林带宽阈值（(upper-lower)/price）。
REGIME_BANDWIDTH_THRESHOLD=0.02511
# 震荡策略：布林带周期。
RANGE_BB_PERIOD=20
# 震荡策略：布林带标准差倍数。
RANGE_BB_STD=2.0810
# 震荡策略：RSI 周期。
RANGE_RSI_PERIOD=16
# 震荡策略：RSI 低位阈值（低于该值考虑做多）。
RANGE_RSI_LONG=36.47
# 震荡策略：RSI 高位阈值（高于该值考虑做空）。
RANGE_RSI_SHORT=64.72
# 震荡策略：触碰布林带边界的容忍度。
RANGE_BAND_BUFFER=0.00122
# 震荡策略：订单流过滤阈值（越小越严格）。
RANGE_FLOW_FILTER=0.131

# 大单与订单流信号
# 统计最近成交笔数：最近 500 笔。
TRADE_LOOKBACK=500
# 大单阈值：单笔成交额 >= 100000 USDT 视为大单。
BIG_TRADE_USDT=100000
# 盘口深度档位：买卖盘各取前 20 档计算失衡。
DEPTH_LEVELS=20
# 订单流综合分数基础阈值（兼容参数，建议同时配置 LONG_FLOW_THRESHOLD/SHORT_FLOW_THRESHOLD）。
FLOW_SCORE_THRESHOLD=0.12
# 多头订单流阈值：flow_score > 该值才允许开多（当前已调优）。
LONG_FLOW_THRESHOLD=0.212
# 空头订单流阈值：flow_score < -该值才允许开空（当前已调优）。
SHORT_FLOW_THRESHOLD=0.075
# 订单流权重：0.6 表示大单失衡占 60%，盘口失衡占 40%。
TRADE_WEIGHT=0.6
# 回测是否融合 aggTrades 订单流，可选：true（融合）/ false（仅 K 线 taker 流）。
BACKTEST_AGGTRADE_FLOW_ENABLED=true
# aggTrades 融合权重，可选范围：[0,1]；0=只看K线流，1=只看aggTrades；当前为 0.70。
BACKTEST_AGGTRADE_FLOW_WEIGHT=0.70
# aggTrades 本地数据目录（按 data/raw_binance 的下载结构）。
BACKTEST_AGGTRADE_DATA_DIR=data/raw_binance/um/aggTrades

# 交易所公开多空情绪过滤（OI / 多空比 / 主动买卖比 / 资金费率）
# 是否启用情绪过滤，可选：false（关闭）/ true（开启）；当前为 true。
SENTIMENT_FILTER_ENABLED=true
# 情绪过滤作用范围，可选：all（所有信号）/ trend_only（仅趋势）/ range_only（仅震荡）；当前为 trend_only。
SENTIMENT_FILTER_MODE=trend_only
# 情绪数据周期，可选：5m、15m、30m、1h、2h、4h、6h、12h、1d；当前为 5m。
SENTIMENT_PERIOD=5m
# 情绪回看长度（最近 N 个周期），可选范围：2~500；当前为 24。
SENTIMENT_LOOKBACK=24
# 至少需要成功拉取的情绪源数量（1~4）；低于该值时策略 fail-open 不拦截信号；当前为 2。
SENTIMENT_MIN_SOURCES=2
# 多单情绪阈值：综合情绪分数 >= 该值才允许开多（分数范围约为 [-1,1]）。
SENTIMENT_LONG_THRESHOLD=0.08
# 空单情绪阈值：综合情绪分数 <= -该值才允许开空（分数范围约为 [-1,1]）。
SENTIMENT_SHORT_THRESHOLD=0.08
# OI 标准化尺度：例如 0.01 表示 open interest 变化 1% 对应满分尺度。
SENTIMENT_OI_SCALE_PCT=0.010
# 资金费率标准化尺度：例如 0.0005 表示资金费率 0.05% 对应满分尺度。
SENTIMENT_FUNDING_SCALE=0.0005
# 多空比来源，可选：global（全市场账户比）/ top_account（大户账户比）/ top_position（大户持仓比）。
SENTIMENT_LONG_SHORT_SOURCE=global
# 多空比是否反向解释（拥挤反转），可选：true / false；当前为 true。
SENTIMENT_LSR_CONTRARIAN=true
# 资金费率是否反向解释（费率越极端越谨慎追涨/杀跌），可选：true / false；当前为 true。
SENTIMENT_FUNDING_CONTRARIAN=true
# 情绪子因子权重（>=0，且至少一个 >0），最终会按权重归一化。
SENTIMENT_OI_WEIGHT=0.35
SENTIMENT_LONG_SHORT_WEIGHT=0.30
SENTIMENT_TAKER_RATIO_WEIGHT=0.25
SENTIMENT_FUNDING_WEIGHT=0.10

# 盘口失衡过滤：是否启用盘口一档失衡门槛（基于实时 depth_imbalance）。
ORDERBOOK_FILTER_ENABLED=true
# 盘口失衡过滤仅用于震荡入场：true=只过滤 RANGE 信号，false=过滤全部信号。
ORDERBOOK_FILTER_RANGE_ONLY=true
# 多单盘口失衡阈值：depth_imbalance >= 该值才允许开多（可选范围：[0,1)）。
ORDERBOOK_LONG_THRESHOLD=0.02000
# 空单盘口失衡阈值：depth_imbalance <= -该值才允许开空（可选范围：[0,1)）。
ORDERBOOK_SHORT_THRESHOLD=0.02000
# 回测盘口数据目录：用于读取 capture_orderbook_realtime.py 采集的本地 jsonl/jsonl.gz。
BACKTEST_ORDERBOOK_DATA_DIR=data/realtime_orderbook
# 回测盘口最小覆盖率：低于该覆盖率时自动停用盘口过滤，避免因样本缺失误杀信号。
BACKTEST_ORDERBOOK_MIN_COVERAGE_PCT=20

# 风控与止盈
# 固定止损比例（相对入场价）。
STOP_LOSS_PCT=0.01837
# 分级止盈阈值（相对入场价）。
TP1_PCT=0.00778
TP2_PCT=0.01607
TP3_PCT=0.02482
# TP1/TP2 分批减仓比例（当前已调优）。
TP1_CLOSE_RATIO=0.3383
TP2_CLOSE_RATIO=0.2305
# 最大持仓K线数（0 表示不限制；若要尽量吃满单边，建议设为 0）。
MAX_HOLD_BARS=0
# 单笔最小目标净利润（USDT）：机器人会据此动态放大 TP1/TP2/TP3。
MIN_PROFIT_USDT=10.08
# 预估单边手续费率（用于实盘脚本计算最小目标空间；0.0004=4bps）。
ESTIMATED_FEE_RATE=0.0004
# 价格空间检查窗口：用最近 N 根K线高低振幅判断是否有足够波动空间（当前已调优）。
PROFIT_SPACE_LOOKBACK=72
# 价格空间安全系数：需要的空间 = 目标空间 * 系数（当前已调优）。
PROFIT_SPACE_BUFFER=1.083
# 是否启用趋势跟随 runner 模式：true=不使用固定 TP3，改为移动止盈追踪剩余仓位。
RUNNER_MODE=true
# 分段移动止盈-宽档（刚进入盈利阶段时给更大回撤空间）。
TRAILING_STOP_LOOSE_PCT=0.0286
# runner 模式移动止盈回撤比例（0.01=从阶段高点/低点回撤 1% 触发离场）。
TRAILING_STOP_PCT=0.0169
# 分段移动止盈-紧档（盈利很深时收紧回撤阈值，减少回吐）。
TRAILING_STOP_TIGHT_PCT=0.0148
# 趋势仓位是否启用“反转K线退出”，可选：true / false；当前为 true。
TREND_REVERSAL_EXIT_ENABLED=true
# 反转K线退出的最小浮盈门槛（达到该浮盈后才启用反转退出，示例：0.01=1%）。
TREND_REVERSAL_MIN_PROFIT_PCT=0.0021
# 震荡模式止损比例。
RANGE_STOP_LOSS_PCT=0.00625
# 震荡模式止盈比例。
RANGE_TAKE_PROFIT_PCT=0.00647
# 震荡模式最大持仓K线数（0 表示不限制）。
RANGE_MAX_HOLD_BARS=24

# 高波动自动降仓（防止极端波动时单笔回撤过大）
# 是否启用高波动自动降仓，可选：false（关闭）/ true（开启）；当前为 true。
VOL_GUARD_ENABLED=false
# 波动判定 ATR 周期，可选示例：10、12、14、16、20；当前为 16。
VOL_GUARD_ATR_PERIOD=12
# 软降仓阈值：当 ATR/价格 >= 该值时触发软降仓（0.003=0.30%）。
VOL_GUARD_ATR_PCT_SOFT=0.00208
# 硬降仓阈值：当 ATR/价格 >= 该值时触发硬降仓（0.005=0.50%）。
VOL_GUARD_ATR_PCT_HARD=0.00442
# 软降仓仓位系数，可选范围：(0,1]；0.60 表示仓位降到 60%。
VOL_GUARD_SOFT_MULTIPLIER=0.609
# 硬降仓仓位系数，可选范围：(0,1] 且建议 <= 软降仓系数；0.35 表示仓位降到 35%。
VOL_GUARD_HARD_MULTIPLIER=0.367
# 行情状态仓位系数-趋势：TREND 模式下的开仓系数，可选范围：(0,1]。
REGIME_SIZE_TREND_MULTIPLIER=0.971
# 行情状态仓位系数-混合：MIXED 模式下的开仓系数，建议 <= TREND。
REGIME_SIZE_MIXED_MULTIPLIER=0.943
# 行情状态仓位系数-震荡：RANGE 模式下的开仓系数，建议 <= MIXED。
REGIME_SIZE_RANGE_MULTIPLIER=0.888

# 入场方式，可选：market（信号即下“激进限价单”）/ pullback_limit（信号后等待回踩/反弹再下限价单）；当前为 pullback_limit。
ENTRY_MODE=pullback_limit
# 入场二次确认K线数：同向信号连续出现 N 根后才允许挂单（1=不需要二次确认）。
ENTRY_CONFIRM_BARS=1
# 混合行情额外确认K线数：实际确认=ENTRY_CONFIRM_BARS+该值（可选：0、1、2...）。
ENTRY_CONFIRM_EXTRA_MIXED=0
# 震荡行情额外确认K线数：实际确认=ENTRY_CONFIRM_BARS+该值（可选：0、1、2...）。
ENTRY_CONFIRM_EXTRA_RANGE=0
# 平仓后冷静期K线数：冷静期内即使有新信号也不再开仓（0=关闭）。
ENTRY_COOLDOWN_BARS=0
# ATR 波动周期：用于动态回踩比例计算。
ENTRY_ATR_PERIOD=12
# ATR 回踩倍数：动态回踩比例=ATR/价格*该倍数（与固定回踩取更大值）。
ENTRY_ATR_MULTIPLIER=1.254
# ATR 动态回踩下限：避免波动过低时挂单过近。
ENTRY_ATR_MIN_PULLBACK_PCT=0.00102
# ATR 动态回踩上限：避免挂单过远导致成交率过低。
ENTRY_ATR_MAX_PULLBACK_PCT=0.00392
# 趋势多单回踩比例：以信号价向下回踩该比例后才开多（0.001=0.1%）。
ENTRY_PULLBACK_LONG_TREND_PCT=0.00094
# 趋势空单反弹比例：以信号价向上反弹该比例后才开空。
ENTRY_PULLBACK_SHORT_TREND_PCT=0.00102
# 震荡多单回踩比例：一般可略大于趋势多单，减少抄底过早。
ENTRY_PULLBACK_LONG_RANGE_PCT=0.00266
# 震荡空单反弹比例：一般可略大于趋势空单，减少摸顶过早。
ENTRY_PULLBACK_SHORT_RANGE_PCT=0.00103
# 挂单等待K线数：超过该数量未触发则取消（0 表示不自动取消）。
ENTRY_MAX_WAIT_BARS=1
# 同向新信号是否刷新挂单价格，可选：false（保留原挂单）/ true（按最新信号重挂）。
ENTRY_REFRESH_ON_SAME_SIGNAL=false
# 开仓限价单 TIF，可选：GTC（一直挂单）/ IOC（立即成交否则撤单）/ FOK（要么全成要么全撤）；当前为 IOC。
ENTRY_LIMIT_TIF=IOC
# market 模式下的激进限价偏移：多单=当前价*(1+偏移)，空单=当前价*(1-偏移)。
ENTRY_LIMIT_OFFSET_PCT=0.00058

# 仓位大小（按保证金 USDT，而非名义价值）
# 每次开仓保证金（USDT）：名义仓位约为 MARGIN_USDT * LEVERAGE。
MARGIN_USDT=60

# 自动仓位引擎（会在基础仓位上按信号强度、行情匹配度和价格空间自动放大/缩小）
# 是否启用自动仓位，可选：false（关闭，固定仓位）/ true（开启，动态仓位）。
AUTO_POSITION_SIZING_ENABLED=true
# 自动仓位最小倍率：最终仓位不会低于基础仓位的该倍数（可选范围：>0，建议 0.3~1.0）。
AUTO_SIZE_MIN_MULTIPLIER=0.60
# 自动仓位最大倍率：最终仓位不会高于基础仓位的该倍数（可选范围：>=最小倍率，建议 1.0~2.0）。
AUTO_SIZE_MAX_MULTIPLIER=1.40
# 自动仓位灵敏度：0=不随信号变化，越大越激进（可选范围：[0,2]）。
AUTO_SIZE_SENSITIVITY=0.85
# 订单流强度参考值：|flow_score| 达到该值附近视为“标准强度”（越小越容易放大仓位）。
AUTO_SIZE_FLOW_REF=0.20
# 趋势强度参考值：trend_strength 达到该值附近视为“标准趋势”（越小越容易放大仓位）。
AUTO_SIZE_TREND_REF=0.0018
# 价格空间参考倍率：space/required_space 达到该值附近视为“空间充足”（越小越容易放大仓位）。
AUTO_SIZE_SPACE_REF=1.30
# 是否按止损宽度再做仓位修正，可选：false / true；true 时震荡止损较小会适度放大，止损较大时收缩。
AUTO_SIZE_STOP_ADJUST_ENABLED=true
# 止损修正最小倍率（可选范围：>0，且 <= AUTO_SIZE_STOP_ADJUST_MAX）。
AUTO_SIZE_STOP_ADJUST_MIN=0.85
# 止损修正最大倍率（可选范围：>= AUTO_SIZE_STOP_ADJUST_MIN）。
AUTO_SIZE_STOP_ADJUST_MAX=1.20

# 安全开关
# 干跑模式，可选：true（仅打印，不真实下单）/ false（真实下单）；当前为 true。
DRY_RUN=true
# 是否使用 Binance 测试网，可选：false（实盘环境）/ true（测试网环境）；当前为 false。
BINANCE_TESTNET=false

AGGTRADE_FLOW_WEIGHT=0.700
